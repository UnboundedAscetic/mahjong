<!-- 顶部透明菜单栏 -->
<div class="top-menu-container">

	<!-- 菜单内容 -->
	<div class="controls controls-top">
		<div class="ctrl ctrl-name">
			<button class="link button" (click)="help.toggle()" title="{{'OPEN_HELP' | translate}}">
				<img src="/assets/logo2.png" alt="Free Mahjong Games" class="logo-image">
			</button>
		</div>
		<div class="ctrl ctrl-game">
			<!-- 隐藏暂停和新游戏按钮，因为已移至左下角浮动菜单 -->
			<button class="link button" style="display: none;" (click)="game.toggle()" title="{{'PAUSE_LONG' | translate}}">
				<i class="icon-pause"></i> <span class="label">{{ 'PAUSE' | translate }}</span>
			</button>
			<button class="link button feature" style="display: none;" [class.enabled]="game.mode | gameModeEasy" (click)="game.shuffle()" title="{{'SHUFFLE_LONG' | translate}}">
				<i class="icon-spin1"></i> <span class="label">{{ 'SHUFFLE' | translate }}</span>
			</button>
			<button class="link button feature" style="display: none;" [class.enabled]="game.mode | gameModeStandard" (click)="game.back()" title="{{'UNDO_LONG' | translate}}" [attr.disabled]="game.board.undo.length===0 ? true : null">
				<i class="icon-undo"></i> <span class="label">{{ 'UNDO' | translate }}</span>
			</button>
			<button class="link button feature" style="display: none;" [class.enabled]="game.mode | gameModeStandard" (click)="game.hint()" title="{{'HINT_LONG' | translate}}">
				<i class="icon-lightbulb"></i> <span class="label">{{ 'HINT' | translate }}</span>
			</button>
			<button class="link button" style="display: none;" (click)="newGame()" title="{{'RESTART_LONG' | translate}}">
				<i class="icon-loop"></i> <span class="label">{{ 'RESTART' | translate }}</span>
			</button>
		</div>
	</div>
</div>
<app-board class="board"
					 [stones]="game.board.stones"
					 [imageSet]="app.settings.tileset"
					 [kyodaiUrl]="app.settings.kyodaiUrl"
					 [background]="app.settings.background"
					 (clickEvent)="stoneClick($event)"
/>
<div class="floating-dock-container" 
     (mousemove)="onDockMouseMove($event)" 
     (mouseleave)="onDockMouseLeave()">
	<div class="floating-dock">
		<!-- 功能按钮组 -->
		<div class="dock-item" 
			 (mouseenter)="onItemHover(0)"
			 [style.transform]="'scale(' + calculateScale(0) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					(click)="settings.toggle()">
				<i class="icon-cog"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 0">
					{{'SETTINGS' | translate}}
				</span>
			</button>
		</div>
		
		<div class="dock-item" 
			 (mouseenter)="onItemHover(1)"
			 [style.transform]="'scale(' + calculateScale(1) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					[class.inactive]="!app.settings.sounds"
					(click)="app.toggleSound()">
				<i class="icon-volume-low"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 1">
					{{'AUDIO_SOUNDS' | translate}}
				</span>
			</button>
		</div>
		
		<div class="dock-item" 
			 (mouseenter)="onItemHover(2)"
			 [style.transform]="'scale(' + calculateScale(2) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					(click)="game.toggle()">
				<i class="icon-pause"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 2">
					{{'PAUSE' | translate}}
				</span>
			</button>
		</div>
		
		<div class="dock-item" 
			 (mouseenter)="onItemHover(3)"
			 [style.transform]="'scale(' + calculateScale(3) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					(click)="newGame()">
				<i class="icon-loop"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 3">
					{{'RESTART' | translate}}
				</span>
			</button>
		</div>

		<!-- 分隔线 -->
		<div class="dock-separator"></div>

		<!-- 功能按钮 -->
		<div class="dock-item" 
			 (mouseenter)="onItemHover(4)"
			 [style.transform]="'scale(' + calculateScale(4) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					[ngClass]="{ inactive: (game.mode | gameModeEasy) === false }"
					[attr.disabled]="(game.mode | gameModeEasy) === false ? true : null"
					(click)="game.shuffle()">
				<i class="icon-spin1"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 4">
					{{'SHUFFLE' | translate}}
				</span>
			</button>
		</div>
		
		<div class="dock-item" 
			 (mouseenter)="onItemHover(5)"
			 [style.transform]="'scale(' + calculateScale(5) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					[ngClass]="{ inactive: (game.mode | gameModeStandard) === false || game.board.hints.groups.length === 0 }"
					[attr.disabled]="(game.mode | gameModeStandard) === false || game.board.hints.groups.length === 0 ? true : null"
					(click)="game.hint()">
				<i class="icon-lightbulb"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 5">
					{{'HINT' | translate}}
				</span>
			</button>
		</div>
		
		<div class="dock-item" 
			 (mouseenter)="onItemHover(6)"
			 [style.transform]="'scale(' + calculateScale(6) + ')'"
			 [style.transform-origin]="'bottom center'">
			<button class="dock-button" 
					[ngClass]="{ inactive: (game.mode | gameModeStandard) === false || game.board.undo.length === 0 }"
					[attr.disabled]="(game.mode | gameModeStandard) === false || game.board.undo.length === 0 ? true : null"
					(click)="game.back()">
				<i class="icon-undo"></i>
				<span class="dock-tooltip" 
					  [class.visible]="hoveredIndex === 6">
					{{'UNDO' | translate}}
				</span>
			</button>
		</div>
	</div>
</div>

<!-- 右下角统计信息 -->
<div class="floating-stats-container">
	<div class="floating-stats">
		<div class="stat-item" 
			 (mouseenter)="onItemHover(7)"
			 [style.transform]="'scale(' + calculateScale(7) + ')'"
			 [style.transform-origin]="'bottom center'">
			<i class="icon-cubes"></i>
			<span class="stat-label">{{ game.board.count }}</span>
			<span class="stat-tooltip" 
				  [class.visible]="hoveredIndex === 7">{{'STONES' | translate}}</span>
		</div>
		
		<div class="stat-item" 
			 (mouseenter)="onItemHover(8)"
			 [style.transform]="'scale(' + calculateScale(8) + ')'"
			 [style.transform-origin]="'bottom center'">
			<i class="icon-check"></i>
			<span class="stat-label">{{ game.board.free.length }}</span>
			<span class="stat-tooltip" 
				  [class.visible]="hoveredIndex === 8">{{'FREE' | translate}}</span>
		</div>
		
		<div class="stat-item" 
			 (mouseenter)="onItemHover(9)"
			 [style.transform]="'scale(' + calculateScale(9) + ')'"
			 [style.transform-origin]="'bottom center'">
			<i class="icon-clock"></i>
			<span class="stat-label">{{ game.clock.elapsed | duration }}</span>
			<span class="stat-tooltip" 
				  [class.visible]="hoveredIndex === 9">{{'TIME' | translate}}</span>
		</div>
	</div>
</div>

<app-dialog #help (clickEvent)="toggleDialogState($event)" className="overlay-help" [title]="title">
	@if (help.visible()) {
		@defer {
			<app-help/>
		}
	}
</app-dialog>

<app-dialog #info (clickEvent)="toggleDialogState($event)" className="overlay-info" [title]="'TILES' | translate">
	@if (info.visible()) {
		@defer {
			<app-tiles-info/>
		}
	}
</app-dialog>

<app-dialog #settings (clickEvent)="toggleDialogState($event)" className="overlay-settings" [title]="'SETTINGS' | translate">
	@if (settings.visible()) {
		@defer {
			<app-settings/>
		}
	}
</app-dialog>

<app-dialog #newgame (clickEvent)="toggleDialogState($event)" className="overlay-newgame" [title]="'SELECT_BOARD' | translate">
	@if (newgame.visible()) {
		<app-choose-layout class="choose" (startEvent)="startGame($event)" [gameMode]="game.mode"/>
	}
</app-dialog>

<app-dialog (clickEvent)="clickMessage()" [visible]="!!game.message" className="overlay-message" [noClose]="true">
	@if (game.message) {
		<div class="overlay-message-message" (click)="clickMessage()">
			@if (game.message.messageID) {
				<div>{{ game.message.messageID | translate }}</div>
			}
			@if (game.message.playTime) {
				<div>{{ game.message.playTime | duration }}</div>
			}
		</div>
	}
</app-dialog>
